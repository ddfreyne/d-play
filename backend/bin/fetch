#!/usr/bin/env ruby
# frozen_string_literal: true

require 'optparse'

require_relative '../lib/d-tune/indexer'

usage = "Usage: #{$PROGRAM_NAME} [options] command"

options = {}
OptionParser.new do |opts|
  opts.banner = usage

  opts.on('-m PATH', '--music-dir-path=PATH', 'Specify path to music directory') do |v|
    options[:music_dir_path] = v
  end

  opts.on('-c PATH', '--csv-path=PATH', 'Specify path to CSV file') do |v|
    options[:csv_path] = v
  end

  opts.on('-h', '--help', 'Print this help') do
    puts opts
    exit 1
  end
end.parse!

unless options.key?(:music_dir_path)
  warn 'Error: music directory path not specified'
  exit 1
end

unless options.key?(:csv_path)
  warn 'Error: CSV path not specified'
  exit 1
end

case ARGV
when []
  DTune::Indexer::Fetcher.new(
    input_directory_path: options[:music_dir_path],
    output_file_path: options[:csv_path],
    parallelism: 10
  ).run
else
  warn usage
  exit 1
end
